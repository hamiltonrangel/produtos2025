<!DOCTYPE html>

<html lang="pt-br">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Buscador de PreÃ§os</title>

Â  Â  <style>

Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; display: flex; flex-direction: column; align-items: center; padding: 1em; min-height: 100vh; margin: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: transparent; }

Â  Â  Â  Â  img { -webkit-user-drag: none; user-drag: none; }

Â  Â  Â  Â  .container { background-color: #fff; padding: 1.5em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); text-align: center; width: 100%; max-width: 500px; margin-bottom: 1em;}

Â  Â  Â  Â  h1 { margin-top: 0; font-size: 1.5em; } h2 { font-size: 1.2em; margin-top: 0; }

Â  Â  Â  Â  p.slogan { font-weight: bold; color: #007bff; margin-top: 0; font-size: 1.1em;}

Â  Â  Â  Â  p.explanation { margin-top: 0; margin-bottom: 1.5em; color: #555; font-size: 0.9em; }

Â  Â  Â  Â  input, button { width: 100%; padding: 12px; margin-bottom: 0.8em; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; } button { color: white; border: none; cursor: pointer; transition: background-color 0.3s ease; } #searchButton { background-color: #007bff; } #scanButtonHtml { background-color: #6c757d; } #saveButton { background-color: #28a745; display: none; margin-top: 1em; } #viewShoppingListButton { background-color: #fd7e14; }

Â  Â  Â  Â  .market-button { background-color: #20c997; }

Â  Â  Â  Â  #changeMarketButton { background-color: #6c757d; font-size: 0.8em; padding: 8px; }

Â  Â  Â  Â  #marketInfoBar { display: flex; flex-direction: column; align-items: flex-start; gap: 0.5em; background-color: #e9ecef; padding: 0.8em 1em; border-radius: 6px; margin-bottom: 1.5em; }

Â  Â  Â  Â  #marketInfoBar p { margin: 0; font-size: 0.9em; color: #495057; text-align: left;}

Â  Â  Â  Â  #changeMarketButton { margin: 0; width: 100%; }

Â  Â  Â  Â  #product-display { margin-top: 1em; } #productImage { max-height: 160px; width: auto; max-width: 100%; margin: 0 auto 0.8em auto; display: block; border-radius: 4px; border: 1px solid #eee; background-color: #f9f9f9; } .icons-container { display: flex; justify-content: center; align-items: center; gap: 1em; margin-bottom: 1em; } #shoppingListIcon { font-size: 36px; cursor: pointer; display: none; transition: transform 0.2s; } #shoppingListIcon:active { transform: scale(0.9); } #quantityInput { width: 60px; text-align: center; display: none; }

Â  Â  Â  Â  #prices-section { margin-top: 1em; text-align: left; display: none; } .prices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8em; } .price-input-group { display: flex; flex-direction: column; align-items: flex-start; } .price-input-group label { margin-bottom: 0.25em; font-size: 0.9em; font-weight: bold; } #statusMessage { color: #555; font-weight: bold; margin-top: 1em; min-height: 20px;}

Â  Â  Â  Â  #shoppingListView { text-align: left; }

Â  Â  Â  Â  .list-item { display: flex; align-items: center; background-color: #f9f9f9; border-radius: 6px; padding: 0.8em; margin-bottom: 0.8em; transition: opacity 0.3s; }

Â  Â  Â  Â  .list-item-info { flex-grow: 1; display: flex; flex-direction: column; text-align: left; } .list-item-info h3 { margin: 0 0 0.25em 0; font-size: 1em; color: #333; } .list-item-info p { margin: 0; font-size: 0.8em; color: #555; }

Â  Â  Â  Â  .quantity-control { display: flex; align-items: center; } .quantity-btn { font-size: 1.5em; background: none; border: none; color: #007bff; cursor: pointer; padding: 0.2em 0.5em; transition: transform 0.1s; }Â 

Â  Â  Â  Â  .quantity-btn:active { transform: scale(0.9); }

Â  Â  Â  Â  .list-item.updating { opacity: 0.5; pointer-events: none; }

Â  Â  Â  Â  #clearListButton { background-color: #dc3545; }

Â  Â  Â  Â  .market-group { margin-bottom: 1.5em; } .market-header { background-color: #e9ecef; padding: 0.5em 1em; border-radius: 6px; margin-bottom: 0.8em; display: flex; justify-content: space-between; align-items: center; } .market-header h2 { margin: 0; font-size: 1.2em; } .market-header b { font-size: 1.1em; }

Â  Â  Â  Â  .icon-success { color: #28a745 !important; font-size: 40px !important; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  input[readonly] {

Â  Â  Â  Â  Â  Â  background-color: #e9ecef;

Â  Â  Â  Â  Â  Â  color: #6c757d;

Â  Â  Â  Â  Â  Â  cursor: not-allowed;

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body>

Â  Â  <div id="selectionView" class="container">

Â  Â  Â  Â  <h2>Bem-vindo(a)!</h2>

Â  Â  Â  Â  <p class="slogan">Juntos, encontramos o melhor preÃ§o.</p>

Â  Â  Â  Â  <p class="explanation">Este Ã© um app colaborativo. Os preÃ§os sÃ£o atualizados pelos prÃ³prios usuÃ¡rios. Contribua tambÃ©m!</p>

Â  Â  Â  Â  <hr style="border: none; border-top: 1px solid #eee; margin-bottom: 1.5em;">

Â  Â  Â  Â  <h1>Onde vocÃª estÃ¡?</h1>

Â  Â  Â  Â  <button class="market-button" data-market-name="SILVA" data-market-key="supermercado1">SILVA</button>

Â  Â  Â  Â  <button class="market-button" data-market-name="SHIBATA" data-market-key="supermercado2">SHIBATA</button>

Â  Â  Â  Â  <button class="market-button" data-market-name="SEMAR" data-market-key="supermercado3">SEMAR</button>

Â  Â  Â  Â  <button class="market-button" data-market-name="PÃƒO DE AÃ‡ÃšCAR" data-market-key="supermercado4">PÃƒO DE AÃ‡ÃšCAR</button>

Â  Â  </div>



Â  Â  <div id="searchView" class="container" style="display: none;">

Â  Â  Â  Â  <div id="marketInfoBar">

Â  Â  Â  Â  Â  Â  <p>Comprando em: <b id="selectedMarketName"></b></p>

Â  Â  Â  Â  Â  Â  <button id="changeMarketButton">Trocar de Supermercado</button>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h1>Buscador de PreÃ§os</h1>

Â  Â  Â  Â  <input type="text" id="barcodeInput" placeholder="Digite ou escaneie o cÃ³digo" inputmode="numeric" pattern="[0-9]*">

Â  Â  Â  Â  <button id="searchButton">Buscar Produto</button>

Â  Â  Â  Â  <button id="scanButtonHtml">ðŸ“· Ler CÃ³digo de Barras</button>

Â  Â  Â  Â  <hr style="border: none; border-top: 1px solid #eee; margin: 1.5em 0;">

Â  Â  Â  Â  <button id="viewShoppingListButton">Ver Lista de Compras</button>

Â  Â  Â  Â  <div id="product-display">

Â  Â  Â  Â  Â  Â  <h2 id="productName" style="margin-bottom: 0.5em;"></h2>

Â  Â  Â  Â  Â  Â  <img id="productImage" src="" alt="">

Â  Â  Â  Â  Â  Â  <div class="icons-container">

Â  Â  Â  Â  Â  Â  Â  Â  <span id="cartFeedback"></span>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="quantityInput" value="1" min="1" inputmode="numeric">

Â  Â  Â  Â  Â  Â  Â  Â  <span id="shoppingListIcon">ðŸ›’</span>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="prices-section">

Â  Â  Â  Â  Â  Â  Â  Â  <h4>PreÃ§os:</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="prices-grid">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="price-input-group"> <label for="supermercado1">SILVA:</label> <input type="text" id="supermercado1" placeholder="0,00" inputmode="decimal"> </div> <div class="price-input-group"> <label for="supermercado2">SHIBATA:</label> <input type="text" id="supermercado2" placeholder="0,00" inputmode="decimal"> </div> <div class="price-input-group"> <label for="supermercado3">SEMAR:</label> <input type="text" id="supermercado3" placeholder="0,00" inputmode="decimal"> </div> <div class="price-input-group"> <label for="supermercado4">PÃƒO DE AÃ‡ÃšCAR:</label> <input type="text" id="supermercado4" placeholder="0,00" inputmode="decimal"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button id="saveButton">Gravar PreÃ§os</button>

Â  Â  Â  Â  <div id="statusMessage"></div>

Â  Â  </div>

Â  Â Â 

Â  Â  <div id="shoppingListView" class="container" style="display: none;">

Â  Â  Â  Â  <h1>Lista de Compras</h1>

Â  Â  Â  Â  <div id="shoppingList"></div>

Â  Â  Â  Â  <h2 style="text-align: right; margin: 1em 0;">Total Geral: <b id="shoppingListTotal">R$ 0,00</b></h2>

Â  Â  Â  Â  <button id="clearListButton">Limpar Lista</button>

Â  Â  Â  Â  <hr style="border: none; border-top: 1px solid #eee; margin: 1.5em 0;">

Â  Â  Â  Â  <button class="backToSearchButton">Voltar</button>

Â  Â  </div>



Â  Â  <script>

Â  Â  Â  Â  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyynicYvXCkvHSH55Wa9I2C2JwrVn01CTLGM9iRptPGxhUcVIYCumDFTkqknAL3FNk/exec";

Â  Â  Â  Â  let selectedSupermarket = null;



Â  Â  Â  Â  const ui = {

Â  Â  Â  Â  Â  Â  selectionView: document.getElementById('selectionView'), marketButtons: document.querySelectorAll('.market-button'),

Â  Â  Â  Â  Â  Â  searchView: document.getElementById('searchView'), selectedMarketName: document.getElementById('selectedMarketName'), changeMarketButton: document.getElementById('changeMarketButton'), barcodeInput: document.getElementById('barcodeInput'), searchButton: document.getElementById('searchButton'), scanButtonHtml: document.getElementById('scanButtonHtml'), saveButton: document.getElementById('saveButton'), productImage: document.getElementById('productImage'), productName: document.getElementById('productName'), statusMessage: document.getElementById('statusMessage'), pricesSection: document.getElementById('prices-section'), shoppingListIcon: document.getElementById('shoppingListIcon'), quantityInput: document.getElementById('quantityInput'),

Â  Â  Â  Â  Â  Â  cartFeedback: document.getElementById('cartFeedback'),

Â  Â  Â  Â  Â  Â  shoppingListView: document.getElementById('shoppingListView'), viewShoppingListButton: document.getElementById('viewShoppingListButton'), shoppingList: document.getElementById('shoppingList'), shoppingListTotal: document.getElementById('shoppingListTotal'),

Â  Â  Â  Â  Â  Â  clearListButton: document.getElementById('clearListButton'), backToSearchButtons: document.querySelectorAll('.backToSearchButton'),

Â  Â  Â  Â  Â  Â  priceInputs: { supermercado1: document.getElementById('supermercado1'), supermercado2: document.getElementById('supermercado2'), supermercado3: document.getElementById('supermercado3'), supermercado4: document.getElementById('supermercado4') }

Â  Â  Â  Â  };

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- LÃ“GICA DA LISTA DE COMPRAS (localStorage) ---

Â  Â  Â  Â  function getShoppingListFromLocal() { const listJSON = localStorage.getItem('shoppingList'); return listJSON ? JSON.parse(listJSON) : []; }

Â  Â  Â  Â  function saveShoppingListToLocal(list) { localStorage.setItem('shoppingList', JSON.stringify(list)); }

Â  Â  Â  Â  function addToShoppingListLocal(itemToAdd) { let list = getShoppingListFromLocal(); const existingItem = list.find(item => item.codigo === itemToAdd.codigo && item.supermercado === itemToAdd.supermercado); if (existingItem) { existingItem.quantidade += itemToAdd.quantidade; existingItem.preco_unitario = itemToAdd.preco_unitario; } else { list.push(itemToAdd); } saveShoppingListToLocal(list); }

Â  Â  Â  Â  function updateShoppingListItemLocal(barcode, marketName, newQuantity) { let list = getShoppingListFromLocal(); if (newQuantity <= 0) { list = list.filter(item => !(item.codigo === barcode && item.supermercado === marketName)); } else { const itemToUpdate = list.find(item => item.codigo === barcode && item.supermercado === marketName); if (itemToUpdate) { itemToUpdate.quantidade = newQuantity; } } saveShoppingListToLocal(list); }

Â  Â  Â  Â  function clearShoppingListLocal() { localStorage.removeItem('shoppingList'); }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- EVENT LISTENERS ---

Â  Â  Â  Â  ui.marketButtons.forEach(btn => btn.addEventListener('click', selectSupermarket));

Â  Â  Â  Â Â 

Â  Â  Â  Â  // âœ… CORREÃ‡ÃƒO APLICADA AQUI

Â  Â  Â  Â  ui.changeMarketButton.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  ui.barcodeInput.value = ''; // Limpa o cÃ³digo de barras digitado

Â  Â  Â  Â  Â  Â  clearUi();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Limpa os dados do produto (nome, imagem, preÃ§os)

Â  Â  Â  Â  Â  Â  showSelectionView();Â  Â  Â  Â  Â // Mostra a tela de seleÃ§Ã£o de supermercado

Â  Â  Â  Â  });

Â  Â  Â  Â Â 

Â  Â  Â  Â  ui.viewShoppingListButton.addEventListener('click', showShoppingListView);

Â  Â  Â  Â  ui.clearListButton.addEventListener('click', clearShoppingList);

Â  Â  Â  Â  ui.backToSearchButtons.forEach(btn => btn.addEventListener('click', showSearchView));

Â  Â  Â  Â  ui.shoppingList.addEventListener('click', handleShoppingListItemClick);

Â  Â  Â  Â  ui.shoppingListIcon.addEventListener('click', addToShoppingList);

Â  Â  Â  Â  ui.scanButtonHtml.addEventListener('click', () => { try { const mensagem = "ACIONAR_SCANNER"; window.AppInventor.setWebViewString(mensagem); } catch (error) { alert("O leitor de cÃ³digo de barras sÃ³ funciona dentro do aplicativo."); } });

Â  Â  Â  Â  ui.searchButton.addEventListener('click', buscarProduto);

Â  Â  Â  Â  ui.saveButton.addEventListener('click', salvarPrecos);

Â  Â  Â  Â  ui.barcodeInput.addEventListener('keyup', e => e.key === 'Enter' && buscarProduto());

Â  Â  Â  Â  Object.values(ui.priceInputs).forEach(input => { input.addEventListener('input', (event) => { event.target.value = event.target.value.replace('.', ','); }); });

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- FUNÃ‡Ã•ES ---

Â  Â  Â  Â  function showSelectionView() { ui.selectionView.style.display = 'block'; ui.searchView.style.display = 'none'; ui.shoppingListView.style.display = 'none'; }

Â  Â  Â  Â  function showSearchView() { ui.selectionView.style.display = 'none'; ui.searchView.style.display = 'block'; ui.shoppingListView.style.display = 'none'; }

Â  Â  Â  Â  function selectSupermarket(event) { const button = event.target; selectedSupermarket = { name: button.dataset.marketName, key: button.dataset.marketKey }; ui.selectedMarketName.textContent = selectedSupermarket.name; showSearchView(); }

Â  Â  Â  Â  function addToShoppingList() { const quantity = parseInt(ui.quantityInput.value, 10); if (!quantity || quantity < 1) { alert("Por favor, insira uma quantidade vÃ¡lida."); return; } const priceInput = ui.priceInputs[selectedSupermarket.key]; const price = priceInput ? parseFloat(priceInput.value.replace(',', '.')) : null; if (price === null || isNaN(price) || price <= 0) { alert(`PreÃ§o para ${selectedSupermarket.name} nÃ£o Ã© vÃ¡lido ou nÃ£o foi preenchido.`); return; } const item = { supermercado: selectedSupermarket.name, codigo: ui.barcodeInput.value.trim(), nome: ui.productName.textContent, quantidade: quantity, preco_unitario: price }; addToShoppingListLocal(item); ui.statusMessage.textContent = ""; ui.cartFeedback.textContent = 'âœ… Adicionado!'; ui.cartFeedback.style.display = 'inline'; setTimeout(() => { ui.cartFeedback.style.display = 'none'; }, 2000); }

Â  Â  Â  Â  function clearShoppingList() { if (confirm("Tem certeza que deseja limpar toda a lista de compras?")) { clearShoppingListLocal(); showShoppingListView(); } }

Â  Â  Â  Â  function showShoppingListView() { ui.selectionView.style.display = 'none'; ui.searchView.style.display = 'none'; ui.shoppingListView.style.display = 'block'; const list = getShoppingListFromLocal(); if (list.length > 0) { let finalHtml = ''; let totalGeral = 0; const groupedByMarket = list.reduce((acc, item) => { (acc[item.supermercado] = acc[item.supermercado] || []).push(item); return acc; }, {}); for (const marketName in groupedByMarket) { let subtotalMercado = 0; let marketItemsHtml = ''; groupedByMarket[marketName].forEach(item => { const subtotalItem = (item.quantidade || 0) * (item.preco_unitario || 0); subtotalMercado += subtotalItem; marketItemsHtml += ` <div class="list-item" data-barcode="${item.codigo}" data-market="${marketName}"> <div class="list-item-info"> <h3>${item.nome}</h3> <p>Qtd: ${item.quantidade} | PreÃ§o: R$ ${String(item.preco_unitario || 0).replace('.', ',')} | Sub: R$ ${subtotalItem.toFixed(2).replace('.', ',')}</p> </div> <div class="quantity-control"> <button class="quantity-btn" data-action="decrease">-</button> <span class="quantity-display">${item.quantidade}</span> <button class="quantity-btn" data-action="increase">+</button> </div> </div>`; }); const marketGroupHtml = ` <div class="market-group"> <div class="market-header"> <h2>${marketName}</h2> <b>Subtotal: R$ ${subtotalMercado.toFixed(2).replace('.', ',')}</b> </div> ${marketItemsHtml} </div> `; finalHtml += marketGroupHtml; totalGeral += subtotalMercado; } ui.shoppingList.innerHTML = finalHtml; ui.shoppingListTotal.textContent = `R$ ${totalGeral.toFixed(2).replace('.', ',')}`; } else { ui.shoppingList.innerHTML = '<p>Sua lista de compras estÃ¡ vazia.</p>'; ui.shoppingListTotal.textContent = 'R$ 0,00'; } }

Â  Â  Â  Â  function handleShoppingListItemClick(event) { const target = event.target; if (target.classList.contains('quantity-btn')) { const itemDiv = target.closest('.list-item'); itemDiv.classList.add('updating'); const barcode = itemDiv.dataset.barcode; const marketName = itemDiv.dataset.market; let currentQuantity = parseInt(itemDiv.querySelector('.quantity-display').textContent, 10); if (target.dataset.action === 'increase') currentQuantity++; else if (target.dataset.action === 'decrease') currentQuantity--; updateShoppingListItemLocal(barcode, marketName, currentQuantity); showShoppingListView(); } }

Â  Â  Â  Â  function receberCodigoDoApp(codigo) { ui.barcodeInput.value = codigo; buscarProduto(); }



Â  Â  Â  Â  function clearUi() {

Â  Â  Â  Â  Â  Â  ui.shoppingListIcon.style.display = 'none';

Â  Â  Â  Â  Â  Â  ui.quantityInput.style.display = 'none';

Â  Â  Â  Â  Â  Â  ui.cartFeedback.style.display = 'none';

Â  Â  Â  Â  Â  Â  ui.quantityInput.value = '1';

Â  Â  Â  Â  Â  Â  ui.productImage.src = '';

Â  Â  Â  Â  Â  Â  ui.productImage.alt = '';

Â  Â  Â  Â  Â  Â  ui.productName.textContent = '';

Â  Â  Â  Â  Â  Â  ui.pricesSection.style.display = 'none';

Â  Â  Â  Â  Â  Â  ui.saveButton.style.display = 'none';

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Object.values(ui.priceInputs).forEach(input => {

Â  Â  Â  Â  Â  Â  Â  Â  input.value = '';

Â  Â  Â  Â  Â  Â  Â  Â  input.readOnly = false;

Â  Â  Â  Â  Â  Â  Â  Â  input.style.border = "1px solid #ccc";

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  if (ui.statusMessage) ui.statusMessage.textContent = '';

Â  Â  Â  Â  }



Â  Â  Â  Â  function atualizarEstadoDosInputsDePreco() {

Â  Â  Â  Â  Â  Â  if (!selectedSupermarket) return;

Â  Â  Â  Â  Â  Â  for (const key in ui.priceInputs) {

Â  Â  Â  Â  Â  Â  Â  Â  const input = ui.priceInputs[key];

Â  Â  Â  Â  Â  Â  Â  Â  if (key === selectedSupermarket.key) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.readOnly = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.style.border = "2px solid #007bff";Â 

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.readOnly = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.style.border = "1px solid #ccc";

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  async function buscarProduto() {

Â  Â  Â  Â  Â  Â  const barcode = ui.barcodeInput.value.trim();

Â  Â  Â  Â  Â  Â  clearUi();

Â  Â  Â  Â  Â  Â  if (barcode === '') { return; }



Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Buscando...';

Â  Â  Â  Â  Â  Â  ui.searchButton.disabled = true;

Â  Â  Â  Â  Â  Â  ui.scanButtonHtml.disabled = true;



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const sheetResponse = await fetch(`${SCRIPT_URL}?barcode=${barcode}`);

Â  Â  Â  Â  Â  Â  Â  Â  const sheetResult = await sheetResponse.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (sheetResult.status === 'success') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Encontrado!';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.shoppingListIcon.style.display = 'inline-block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.quantityInput.style.display = 'inline-block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = sheetResult.data;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.productName.textContent = data.nome;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.productImage.src = data.imageUrl || '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado1.value = data.supermercado1 ? String(data.supermercado1).replace('.', ',') : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado2.value = data.supermercado2 ? String(data.supermercado2).replace('.', ',') : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado3.value = data.supermercado3 ? String(data.supermercado3).replace('.', ',') : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado4.value = data.supermercado4 ? String(data.supermercado4).replace('.', ',') : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  atualizarEstadoDosInputsDePreco();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.pricesSection.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.saveButton.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'NÃ£o encontrado. Buscando online...';

Â  Â  Â  Â  Â  Â  Â  Â  const foodFactsUrl = `https://br.openfoodfacts.org/api/v0/product/${barcode}.json`;

Â  Â  Â  Â  Â  Â  Â  Â  const foodFactsResponse = await fetch(foodFactsUrl);

Â  Â  Â  Â  Â  Â  Â  Â  const foodFactsData = await foodFactsResponse.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (foodFactsData.status === 1 && foodFactsData.product) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Encontrado online!';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.shoppingListIcon.style.display = 'inline-block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.quantityInput.style.display = 'inline-block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.productName.textContent = foodFactsData.product.product_name || 'Nome nÃ£o encontrado';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.productImage.src = foodFactsData.product.image_url || '';



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  atualizarEstadoDosInputsDePreco();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.pricesSection.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.saveButton.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Produto nÃ£o encontrado.';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Ocorreu um erro na comunicaÃ§Ã£o.';

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  ui.searchButton.disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  ui.scanButtonHtml.disabled = false;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  async function salvarPrecos() {

Â  Â  Â  Â  Â  Â  const barcode = ui.barcodeInput.value.trim();

Â  Â  Â  Â  Â  Â  const name = ui.productName.textContent;

Â  Â  Â  Â  Â  Â  const imageUrl = ui.productImage.src;

Â  Â  Â  Â  Â  Â  const prices = [

Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado1.value.replace(',', '.'),

Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado2.value.replace(',', '.'),

Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado3.value.replace(',', '.'),

Â  Â  Â  Â  Â  Â  Â  Â  ui.priceInputs.supermercado4.value.replace(',', '.')

Â  Â  Â  Â  Â  Â  ];



Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Gravando na planilha...';

Â  Â  Â  Â  Â  Â  ui.saveButton.disabled = true;



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const postData = { barcode, name, prices, imageUrl };

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(SCRIPT_URL, {

Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  // âœ… ALTERAÃ‡ÃƒO: Enviando como texto, o que evita o bloqueio de seguranÃ§a do navegador.

Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'text/plain;charset=utf-8' },Â 

Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(postData),

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();



Â  Â  Â  Â  Â  Â  Â  Â  if (result.status === 'success') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.innerHTML = `âœ… ${result.message}`;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = `Erro ao gravar: ${result.message}`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  ui.statusMessage.textContent = 'Falha na comunicaÃ§Ã£o ao gravar os dados.';

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Erro em salvarPrecos:', error);

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  ui.saveButton.disabled = false;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', showSelectionView);

Â  Â  </script>

</body>

</html>
